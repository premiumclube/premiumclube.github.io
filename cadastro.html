<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Oficial | Premium Clube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-brand { background: linear-gradient(135deg, #1e3668 0%, #0f172a 100%); }
        .btn-loading { pointer-events: none; opacity: 0.6; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <div id="loginOverlay" class="fixed inset-0 z-50 gradient-brand flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-[2rem] shadow-2xl max-w-md w-full text-center">
            <img src="assets/logo-tran.png" alt="Logo" class="h-10 mx-auto mb-6">
            <h2 class="text-xl font-black text-[#1e3668] mb-2 uppercase italic">Acesso Consultor</h2>
            <input type="email" id="emailConsultor" placeholder="seuemail@premiumclube.app.br" class="w-full px-4 py-3 rounded-xl border border-slate-200 mb-4 outline-none focus:border-orange-400">
            <button onclick="validarConsultor()" class="w-full bg-[#1e3668] text-white py-4 rounded-xl font-bold uppercase tracking-widest text-xs">Validar Acesso</button>
            <p id="erroLogin" class="text-red-500 text-[10px] mt-3 hidden font-bold italic underline">E-MAIL NÃO AUTORIZADO.</p>
        </div>
    </div>

    <main id="mainContent" class="hidden py-12 px-4">
        <div class="max-w-2xl mx-auto bg-white rounded-[2.5rem] shadow-xl overflow-hidden border border-slate-100">
            <div class="gradient-brand p-8 text-white text-center">
                <h1 class="text-2xl font-black italic uppercase tracking-tighter">Ficha de Adesão Digital</h1>
                <p id="consultorTexto" class="text-orange-400 text-[10px] mt-2 font-bold uppercase"></p>
            </div>

            <form id="cadastroForm" class="p-8 space-y-6">
                <div class="space-y-4">
                    <h3 class="text-xs font-black text-[#1e3668] uppercase border-b pb-2 tracking-widest">1. Dados do Associado</h3>
                    <input type="text" name="nome" id="nome" required placeholder="Nome Completo" class="w-full px-4 py-3 rounded-xl border border-slate-200 text-sm outline-none focus:border-orange-400">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="tel" name="telefone" required placeholder="WhatsApp" class="w-full px-4 py-3 rounded-xl border border-slate-200 text-sm outline-none">
                        <select name="vencimento" id="vencimento" required class="w-full px-4 py-3 rounded-xl border border-slate-200 text-sm font-bold bg-slate-50">
                            <option value="">Vencimento</option>
                            <option value="3">Dia 03</option><option value="9">Dia 09</option><option value="11">Dia 11</option>
                            <option value="17">Dia 17</option><option value="21">Dia 21</option><option value="26">Dia 26</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-xs font-black text-[#1e3668] uppercase border-b pb-2 tracking-widest">2. Documentos (Fotos)</h3>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="flex items-center gap-3 bg-slate-50 p-4 rounded-xl border border-dashed border-slate-300">
                            <i data-lucide="camera" class="text-slate-400"></i>
                            <div class="flex-1">
                                <span class="block text-[10px] font-bold text-slate-500 uppercase">Foto da CNH</span>
                                <input type="file" id="foto_cnh" accept="image/*" capture="camera" required class="text-[10px]">
                            </div>
                        </div>
                        <div class="flex items-center gap-3 bg-slate-50 p-4 rounded-xl border border-dashed border-slate-300">
                            <i data-lucide="car" class="text-slate-400"></i>
                            <div class="flex-1">
                                <span class="block text-[10px] font-bold text-slate-500 uppercase">Documento do Veículo</span>
                                <input type="file" id="foto_doc" accept="image/*" capture="camera" required class="text-[10px]">
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" id="btnSubmit" class="w-full bg-[#1e3668] text-white py-5 rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg hover:bg-slate-800 transition-all flex items-center justify-center gap-3">
                    <i data-lucide="send"></i> Enviar Cadastro Agora
                </button>
            </form>
        </div>
    </main>

    <script>
        lucide.createIcons();
        
        const PUBLIC_KEY = "bi4eqDwedWTWcN0SO";
        const SERVICE_ID = "premium_clube";
        const TEMPLATE_ID = "template_m4qc6vo";
        emailjs.init(PUBLIC_KEY);

        let emailLogado = "";
        const listaPermitida = ['stefano@premiumclube.app.br', 'stefano@crocksfrio.com.br']; // Adicione aqui

        function validarConsultor() {
            const input = document.getElementById('emailConsultor').value.toLowerCase().trim();
            if(listaPermitida.includes(input)) {
                emailLogado = input;
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('consultorTexto').innerText = `Consultor: ${emailLogado}`;
            } else {
                document.getElementById('erroLogin').classList.remove('hidden');
            }
        }

        // Função para comprimir imagem
        async function comprimirImagem(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 1000;
                        let width = img.width;
                        let height = img.height;
                        if (width > MAX_WIDTH) {
                            height *= MAX_WIDTH / width;
                            width = MAX_WIDTH;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7)); // Qualidade 70%
                    };
                };
            });
        }

        document.getElementById('cadastroForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btnSubmit');
            btn.innerText = "COMPRIMINDO E ENVIANDO...";
            btn.classList.add('btn-loading');

            try {
                const cnhBase64 = await comprimirImagem(document.getElementById('foto_cnh').files[0]);
                const docBase64 = await comprimirImagem(document.getElementById('foto_doc').files[0]);

                const params = {
                    email_consultor: emailLogado,
                    nome_associado: document.getElementById('nome').value,
                    telefone_associado: document.getElementById('tel').value,
                    vencimento: document.getElementById('vencimento').value,
                    foto_cnh: cnhBase64,
                    foto_doc: docBase64
                };

                await emailjs.send(SERVICE_ID, TEMPLATE_ID, params);
                alert("Cadastro enviado com sucesso ao seu e-mail!");
                location.reload();
            } catch (err) {
                alert("Erro no envio. Verifique o tamanho das fotos.");
                console.error(err);
                btn.innerText = "TENTAR NOVAMENTE";
                btn.classList.remove('btn-loading');
            }
        });

        // Máscara Tel
        document.getElementById('tel').addEventListener('input', e => {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });
    </script>
</body>
</html>