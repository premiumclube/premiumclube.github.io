<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Propostas - Premium Clube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }</style>
</head>
<body class="text-slate-900 p-6">
    <div class="max-w-4xl mx-auto bg-white rounded-3xl p-8 shadow-2xl border border-slate-200">
        <div class="flex items-center gap-4 mb-8 border-b pb-4">
            <i data-lucide="settings" class="w-8 h-8 text-[#1e3668]"></i>
            <h1 class="text-3xl font-black text-[#1e3668] uppercase italic">Gerador de Proposta</h1>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">Nome do Cliente *</label>
                    <input type="text" id="cliNome" class="w-full px-4 py-3 rounded-xl border bg-slate-50 outline-none" placeholder="Ex: João Silva">
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">Telefone/WhatsApp *</label>
                    <input type="text" id="cliPhone" class="w-full px-4 py-3 rounded-xl border bg-slate-50 outline-none" placeholder="(77) 99999-9999">
                </div>

                <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <h3 class="font-bold text-[#1e3668] mb-3 uppercase text-xs tracking-wider">Coberturas Opcionais Selecionadas:</h3>
                    <div class="space-y-2 text-sm" id="opcionais-checkboxes">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Vidros, parabrisas, retrovisores, faróis"> Vidros, parabrisas, retrovisores, faróis</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Kit GNV (até 3500)"> Kit GNV (até 3500)</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Kit GNV (até 4500)"> Kit GNV (até 4500)</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Kit GNV (até 6000)"> Kit GNV (até 6000)</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Fenômenos da Natureza"> Fenômenos da Natureza</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Proteção Terceiro +R$ 100.000,00"> Proteção Terceiro +R$ 100.000,00</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" value="Monitoramento/Rastreamento"> Monitoramento/Rastreamento</label>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">Código JSON da Cotação *</label>
                    <textarea id="jsonInput" rows="12" class="w-full px-4 py-3 rounded-xl border bg-slate-900 text-green-400 font-mono text-[10px] outline-none" placeholder='Cole o conteúdo do arquivo .json aqui...'></textarea>
                </div>

                <button onclick="gerarLink()" class="w-full bg-[#f47920] hover:bg-orange-600 text-white py-4 rounded-xl font-black text-lg uppercase shadow-lg transition-transform active:scale-95 italic">
                    Gerar Link da Proposta
                </button>

                <div id="resultadoBox" class="hidden animate-pulse p-4 bg-green-50 border border-green-200 rounded-xl text-center">
                    <p class="text-xs font-bold text-green-800">Link copiado com sucesso!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        function gerarLink() {
            const nome = document.getElementById('cliNome').value;
            const phone = document.getElementById('cliPhone').value;
            let jsonRaw = document.getElementById('jsonInput').value.trim();

            if(!nome || !jsonRaw) { alert('Preencha Nome e o JSON!'); return; }

            // Limpa aspas extras se houver
            if(jsonRaw.startsWith('"')) jsonRaw = jsonRaw.substring(1);
            if(jsonRaw.endsWith('"')) jsonRaw = jsonRaw.substring(0, jsonRaw.length - 1);

            try {
                const dataObj = JSON.parse(jsonRaw);
                
                // Consolida dados
                const payload = {
                    cliente: { nome: nome, tel: phone },
                    dados: dataObj,
                    extras: Array.from(document.querySelectorAll('#opcionais-checkboxes input:checked')).map(c => c.value)
                };

                // Codifica com suporte a caracteres especiais (acentos)
                const base64 = btoa(encodeURIComponent(JSON.stringify(payload)));
                const urlBase = window.location.href.split('gerador.html')[0];
                const finalUrl = `${urlBase}proposta.html?data=${base64}`;

                // Copia para área de transferência
                navigator.clipboard.writeText(finalUrl);
                document.getElementById('resultadoBox').classList.remove('hidden');
                
                // Abre aba de teste
                window.open(finalUrl, '_blank');

            } catch(e) {
                alert('Erro no formato do JSON. Verifique vírgulas e aspas.');
                console.error(e);
            }
        }
    </script>
</body>
</html>